/*! DirtyForm v0.4.0 | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DirtyForm=t()}(this,function(){"use strict";function e(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,n(a.key),a)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function t(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}var i=function(){return e(function e(n){var i=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t(this,"valueChanged",function(e){var t=e.target;if("radio"===t.type)i.initialValues[t.name]!==t.value&&i.markAsDirty();else if("checkbox"===t.type){var n="".concat(t.name,":").concat(t.value);i.initialValues[n]!==t.checked&&i.markAsDirty()}else i.initialValues[t.name]!==t.value&&i.markAsDirty()}),t(this,"beforeUnload",function(e){i.isDirty&&(e.preventDefault(),e.returnValue=i.message)}),t(this,"onLeave",function(e){i.isDirty?confirm(i.message)?i.beforeLeave&&i.beforeLeave():e.preventDefault():i.isDirty=!1}),this.form=n,this.isDirty=!1,this.initialValues={},this.onDirty=a.onDirty,this.beforeLeave=a.beforeLeave,this.message=a.message||"You have unsaved changes!",this.debouncedValueChanged=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var i=arguments.length,a=new Array(i),r=0;r<i;r++)a[r]=arguments[r];clearTimeout(t),t=setTimeout(function(){e.apply(void 0,a)},n)}}(this.valueChanged),this.setupFieldsTracking(),a.skipLeavingTracking||this.setLeavingHandler()},[{key:"disconnect",value:function(){this.removeFieldsTracking(),this.removeLeavingHandler()}},{key:"setupFieldsTracking",value:function(){var e=this;this.fields.forEach(function(t){if("radio"===t.type){if(!e.initialValues.hasOwnProperty(t.name)){var n=CSS.escape(t.name),i=e.form.querySelector('input[type="radio"][name="'.concat(n,'"]:checked'));e.initialValues[t.name]=i?i.value:""}}else if("checkbox"===t.type){var a="".concat(t.name,":").concat(t.value);e.initialValues[a]=t.checked}else e.initialValues[t.name]=t.value;switch(t.tagName){case"TRIX-EDITOR":t.addEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":t.addEventListener("change",e.debouncedValueChanged);break;default:t.addEventListener("change",e.debouncedValueChanged),t.addEventListener("input",e.debouncedValueChanged)}})}},{key:"removeFieldsTracking",value:function(){var e=this;this.fields.forEach(function(t){switch(t.tagName){case"TRIX-EDITOR":t.removeEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":t.removeEventListener("change",e.debouncedValueChanged);break;default:t.removeEventListener("change",e.debouncedValueChanged),t.removeEventListener("input",e.debouncedValueChanged)}})}},{key:"setLeavingHandler",value:function(){window.addEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.addEventListener("turbo:before-visit",this.onLeave)}},{key:"removeLeavingHandler",value:function(){window.removeEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.removeEventListener("turbo:before-visit",this.onLeave)}},{key:"fields",get:function(){var e=this.constructor.trackedTags.map(function(e){return"".concat(e,"[name]")}).join(",");return e+=",TRIX-EDITOR",Array.from(this.form.querySelectorAll(e)).filter(function(e){return"false"!==e.getAttribute("data-dirty-form")})}},{key:"markAsDirty",value:function(){this.isDirty||(this.isDirty=!0,this.onDirty&&this.onDirty())}}])}();return t(i,"trackedTags",["INPUT","SELECT","TEXTAREA"]),i});
