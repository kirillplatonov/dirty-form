/*! DirtyForm v0.4.0 | MIT License */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).DirtyForm=t()}(this,function(){"use strict";function e(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,n(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function t(e,t,i){return(t=n(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function n(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}var i=function(){return e(function e(n){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),t(this,"valueChanged",function(e){var t=e.target;i.initialValues[t.name]!=t.value&&i.markAsDirty()}),t(this,"beforeUnload",function(e){i.isDirty&&(e.preventDefault(),e.returnValue=i.message)}),t(this,"onLeave",function(e){i.isDirty?confirm(i.message)?i.beforeLeave&&i.beforeLeave():e.preventDefault():i.isDirty=!1}),this.form=n,this.isDirty=!1,this.initialValues={},this.onDirty=r.onDirty,this.beforeLeave=r.beforeLeave,this.message=r.message||"You have unsaved changes!",this.debouncedValueChanged=function(e){var t,n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];clearTimeout(t),t=setTimeout(function(){e.apply(n,a)},i)}}(this.valueChanged),this.setupFieldsTracking(),r.skipLeavingTracking||this.setLeavingHandler()},[{key:"disconnect",value:function(){this.removeFieldsTracking(),this.removeLeavingHandler()}},{key:"setupFieldsTracking",value:function(){var e=this;this.fields.forEach(function(t){switch(e.initialValues[t.name]=t.value,t.tagName){case"TRIX-EDITOR":t.addEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":t.addEventListener("change",e.debouncedValueChanged);break;default:t.addEventListener("change",e.debouncedValueChanged),t.addEventListener("input",e.debouncedValueChanged)}})}},{key:"removeFieldsTracking",value:function(){var e=this;this.fields.forEach(function(t){switch(t.tagName){case"TRIX-EDITOR":t.removeEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":t.removeEventListener("change",e.debouncedValueChanged);break;default:t.removeEventListener("change",e.debouncedValueChanged),t.removeEventListener("input",e.debouncedValueChanged)}})}},{key:"setLeavingHandler",value:function(){window.addEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.addEventListener("turbo:before-visit",this.onLeave)}},{key:"removeLeavingHandler",value:function(){window.removeEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.removeEventListener("turbo:before-visit",this.onLeave)}},{key:"fields",get:function(){var e=this.constructor.trackedTags.map(function(e){return"".concat(e,"[name]")}).join(",");return e+=",TRIX-EDITOR",Array.from(this.form.querySelectorAll(e)).filter(function(e){return"false"!=e.getAttribute("data-dirty-form")})}},{key:"markAsDirty",value:function(){this.isDirty||(this.isDirty=!0,this.onDirty&&this.onDirty())}}])}();return t(i,"trackedTags",["INPUT","SELECT","TEXTAREA"]),i});
