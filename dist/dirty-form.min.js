/*! DirtyForm v0.4.0 | MIT License */
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).DirtyForm=n()}(this,function(){"use strict";function e(e,n,i){return n&&function(e,n){for(var i=0;i<n.length;i++){var r=n[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,t(r.key),r)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function n(e,n,i){return(n=t(n))in e?Object.defineProperty(e,n,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[n]=i,e}function t(e){var n=function(e,n){if("object"!=typeof e||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var i=t.call(e,n);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===n?String:Number)(e)}(e,"string");return"symbol"==typeof n?n:n+""}var i=function(){return e(function e(t){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),n(this,"valueChanged",function(e){var n=e.target;i.initialValues[n.name]!==n.value&&i.markAsDirty()}),n(this,"beforeUnload",function(e){i.isDirty&&(e.preventDefault(),e.returnValue=i.message)}),n(this,"onLeave",function(e){i.isDirty?confirm(i.message)?i.beforeLeave&&i.beforeLeave():e.preventDefault():i.isDirty=!1}),this.form=t,this.isDirty=!1,this.initialValues={},this.onDirty=r.onDirty,this.beforeLeave=r.beforeLeave,this.message=r.message||"You have unsaved changes!",this.debouncedValueChanged=function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;return function(){for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];clearTimeout(n),n=setTimeout(function(){e.apply(void 0,r)},t)}}(this.valueChanged),this.setupFieldsTracking(),r.skipLeavingTracking||this.setLeavingHandler()},[{key:"disconnect",value:function(){this.removeFieldsTracking(),this.removeLeavingHandler()}},{key:"setupFieldsTracking",value:function(){var e=this;this.fields.forEach(function(n){switch(e.initialValues[n.name]=n.value,n.tagName){case"TRIX-EDITOR":n.addEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":n.addEventListener("change",e.debouncedValueChanged);break;default:n.addEventListener("change",e.debouncedValueChanged),n.addEventListener("input",e.debouncedValueChanged)}})}},{key:"removeFieldsTracking",value:function(){var e=this;this.fields.forEach(function(n){switch(n.tagName){case"TRIX-EDITOR":n.removeEventListener("trix-change",e.debouncedValueChanged);break;case"SELECT":n.removeEventListener("change",e.debouncedValueChanged);break;default:n.removeEventListener("change",e.debouncedValueChanged),n.removeEventListener("input",e.debouncedValueChanged)}})}},{key:"setLeavingHandler",value:function(){window.addEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.addEventListener("turbo:before-visit",this.onLeave)}},{key:"removeLeavingHandler",value:function(){window.removeEventListener("beforeunload",this.beforeUnload),"undefined"!=typeof Turbo&&document.removeEventListener("turbo:before-visit",this.onLeave)}},{key:"fields",get:function(){var e=this.constructor.trackedTags.map(function(e){return"".concat(e,"[name]")}).join(",");return e+=",TRIX-EDITOR",Array.from(this.form.querySelectorAll(e)).filter(function(e){return"false"!==e.getAttribute("data-dirty-form")})}},{key:"markAsDirty",value:function(){this.isDirty||(this.isDirty=!0,this.onDirty&&this.onDirty())}}])}();return n(i,"trackedTags",["INPUT","SELECT","TEXTAREA"]),i});
